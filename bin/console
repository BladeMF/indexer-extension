#!/usr/bin/env php
<?php

use Acme\Extension\StupidCompletion\StupidCompletionExtension;
use Phpactor\Container\PhpactorContainer;
use Phpactor\Extension\ClassToFile\ClassToFileExtension;
use Phpactor\Extension\Completion\CompletionExtension;
use Phpactor\Extension\ComposerAutoloader\ComposerAutoloaderExtension;
use Phpactor\Extension\Console\ConsoleExtension;
use Phpactor\Extension\LanguageServer\LanguageServerExtension;
use Phpactor\Extension\Logger\LoggingExtension;
use Phpactor\Extension\ReferenceFinder\ReferenceFinderExtension;
use Phpactor\Extension\Rpc\RpcExtension;
use Phpactor\Extension\SourceCodeFilesystem\SourceCodeFilesystemExtension;
use Phpactor\Extension\WorseReflection\WorseReflectionExtension;
use Phpactor\FilePathResolverExtension\FilePathResolverExtension;
use Phpactor\WorkspaceQuery\Extension\WorkspaceQueryExtension;
use Symfony\Component\Console\Application;

require __DIR__ . '/../vendor/autoload.php';

$container = PhpactorContainer::fromExtensions([
    ConsoleExtension::class,
    WorkspaceQueryExtension::class,
    FilePathResolverExtension::class,
    LoggingExtension::class,
    SourceCodeFilesystemExtension::class,
    WorseReflectionExtension::class,
    ClassToFileExtension::class,
    ComposerAutoloaderExtension::class,
    ReferenceFinderExtension::class,
    LanguageServerExtension::class,
], [
    FilePathResolverExtension::PARAM_APPLICATION_ROOT => __DIR__ . '/../',
    WorkspaceQueryExtension::PARAM_INDEX_PATH => __DIR__ . '/../cache',
    //WorkspaceQueryExtension::PARAM_DEFAULT_FILESYSTEM => 'simple',
    WorseReflectionExtension::PARAM_ENABLE_CACHE => true,
    LoggingExtension::PARAM_ENABLED => true,
    LoggingExtension::PARAM_LEVEL => 'debug',
    LanguageServerExtension::PARAM_WELCOME_MESSAGE => 'Indexer test server',
    LoggingExtension::PARAM_PATH=> 'php://stderr',
]);

$application = new Application();
$application->setCommandLoader(
    $container->get(ConsoleExtension::SERVICE_COMMAND_LOADER)
);
$application->run();
